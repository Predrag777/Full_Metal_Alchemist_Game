<html>
    <head>
        <title>Full Metal</title>
        <link rel="stylesheet" href="style/main_style.css">
    </head>
    <body id="body">
        <div id="main_player"></div>
    </body>
    <script>
        class Enemy {
            constructor(id, x, y) {
                this.x = x;
                this.y = y;
                this.id = id;
                this.move = false;
                this.jump = false;
                this.attack = false;
            }

            startMove() {
                this.move = true;
                console.log('Enemy started moving');
            }

            stopMove() {
                this.move = false;
                console.log('Enemy stopped moving');
            }

            startJump() {
                this.jump = true;
                console.log('Enemy jumped');
            }

            stopJump() {
                this.jump = false;
                console.log('Enemy landed');
            }

            startAttack() {
                this.attack = true;
                console.log('Enemy started attacking');
            }

            stopAttack() {
                this.attack = false;
                console.log('Enemy stopped attacking');
            }
        }

        function createEnemy(id, x, y) {
            const enemy = document.createElement("div");
            enemy.id = `enemy-${id}`;
            enemy.style.backgroundColor = "green";
            enemy.style.width = "100px"; 
            enemy.style.height = "200px"; 
            enemy.style.position = "absolute"; 
            enemy.style.left = x + "px"; 
            enemy.style.top = y + "px"; 
            enemy.classList.add("enemy");
            document.getElementById("body").appendChild(enemy);
        }

        function updateEnemyPosition(id, x, y) {
            const enemy = document.getElementById(`enemy-${id}`);
            if (enemy) {
                enemy.style.left = x + "px";
                enemy.style.top = y + "px";
            }
        }

        var x = 200;
        var y = 700;
        var speed = 0, jumpSpeed = 0, myCounter = 0;
        var jump = false, reachedTop = false, weapon1 = false, move = false;
        var alchemyAttack=false

        var enemySpeed = 20, enemyJumpSpeed = 40;
        var enemyJump = false, enemyReachTop = false;
        

        var numberOfEnemy = 2;
        var enemiesList = [];

        for (let i = 0; i < numberOfEnemy; i++) {
            const newEnemy = new Enemy(i, 800 + i * 200, 700);
            createEnemy(i, newEnemy.x, newEnemy.y);
            enemiesList.push(newEnemy);
        }

        var urlImage = 'url("images/characters/edward/edwardelricBase.png")';

        function setPlayer(x, y) {
            var div = document.getElementById("main_player");
            div.style.marginLeft = x + "px";
            div.style.marginTop = y + "px";
            div.style.backgroundImage = urlImage;
        }

        document.addEventListener('keydown', function (event) {
            if (event.key === 'ArrowUp' && !jump) {
                jump = true;
                jumpSpeed = 50;
            }
            if (event.key === 'ArrowRight') {
                move = true;
                speed = 20;
            }
            if (event.key === 'ArrowLeft') {
                move = true;
                speed = -20;
            }
            if (event.key === "1" && !jump) {
                weapon1 = true;
            }
            if(event.key ==="a"){
                attack=true
            }
        });

        function handleMovement() {
            if (move) {
                x += speed;
                urlImage = (urlImage.includes('edwardelricBase.png')) 
                    ? 'url("images/characters/edward/edwardelricBase2.png")' 
                    : 'url("images/characters/edward/edwardelricBase.png")';
                move = false;
                speed = 0;
            }
        }

        function handleJump() {
            if (jump) {
                y -= jumpSpeed;
                if (y < 500 && !reachedTop) {
                    jumpSpeed *= -1;
                    reachedTop = true;
                }
                if (reachedTop && y >= 700) {
                    y = 700;
                    jumpSpeed = 0;
                    jump = false;
                    reachedTop = false;
                    urlImage = 'url("images/characters/edward/edwardelricBase.png")';
                } else {
                    urlImage = 'url("images/characters/edward/edwardelricJump.png")';
                }
            }
        }

        function handleWeapon1() {
            if (weapon1) {
                myCounter++;
                if (myCounter < 15) {
                    urlImage = 'url("images/characters/edward/edwardelricCallWeapon.png")';
                } else if (myCounter < 20) {
                    urlImage = 'url("images/characters/edward/edwardelricWeapon1.png")';
                    weapon1 = false;
                } else {
                    myCounter = 0;
                    weapon1 = false;
                }
            }
        }

        function moveEnemies(id) {
            if(enemiesList[id].x-enemySpeed>50)
                enemiesList[id].x -= enemySpeed;
            updateEnemyPosition(id, enemiesList[id].x, enemiesList[id].y);
        }

        function enemyNextMove(myX, myY, x, y, jump, enemyJump){
            if(x<myX+150){
                return 2//right
            }

            if(x>myX+150){
                return 1//left
            }

            if(alchemyAttack)
                return 3//jump

            if(attack && x<myX+200)
                return 2//right
        }


        

        function jumpEnemies(id) {
            enemiesList[id].y -= enemyJumpSpeed;
            if (enemiesList[id].y < 500 && !enemyReachTop) {
                enemyJumpSpeed *= -1;
                enemyReachTop = true;
            }
            if (enemyReachTop && enemiesList[id].y>700) {
                enemiesList[id].y = 700;
                enemyJumpSpeed = 0;
                enemyJump = false;
                enemyReachTop = false;
            }
            updateEnemyPosition(id, enemiesList[id].x, enemiesList[id].y);
        }

        var repaint = setInterval(function () {
            //moveEnemies(0); 
            //jumpEnemies(0)
            var pullMove=enemyNextMove(x,y,enemiesList[0].x,enemiesList[0].y,jump, enemyJump)
            
            console.log(x+"     "+enemiesList[0].x)



            handleMovement();
            handleJump();
            handleWeapon1();
            setPlayer(x, y);

            for (let i = 0; i < numberOfEnemy; i++) {
                updateEnemyPosition(i, enemiesList[i].x, enemiesList[i].y);
            }
        }, 100);

        setPlayer(x, y);
    </script>
</html>
